{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _ProtectionController = require('./controllers/ProtectionController');\n\nvar _ProtectionController2 = _interopRequireDefault(_ProtectionController);\n\nvar _ProtectionKeyController = require('./controllers/ProtectionKeyController');\n\nvar _ProtectionKeyController2 = _interopRequireDefault(_ProtectionKeyController);\n\nvar _ProtectionEvents = require('./ProtectionEvents');\n\nvar _ProtectionEvents2 = _interopRequireDefault(_ProtectionEvents);\n\nvar _ProtectionErrors = require('./errors/ProtectionErrors');\n\nvar _ProtectionErrors2 = _interopRequireDefault(_ProtectionErrors);\n\nvar _ProtectionModel_21Jan = require('./models/ProtectionModel_21Jan2015');\n\nvar _ProtectionModel_21Jan2 = _interopRequireDefault(_ProtectionModel_21Jan);\n\nvar _ProtectionModel_3Feb = require('./models/ProtectionModel_3Feb2014');\n\nvar _ProtectionModel_3Feb2 = _interopRequireDefault(_ProtectionModel_3Feb);\n\nvar _ProtectionModel_01b = require('./models/ProtectionModel_01b');\n\nvar _ProtectionModel_01b2 = _interopRequireDefault(_ProtectionModel_01b);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar APIS_ProtectionModel_01b = [// Un-prefixed as per spec\n{\n  // Video Element\n  generateKeyRequest: 'generateKeyRequest',\n  addKey: 'addKey',\n  cancelKeyRequest: 'cancelKeyRequest',\n  // Events\n  needkey: 'needkey',\n  keyerror: 'keyerror',\n  keyadded: 'keyadded',\n  keymessage: 'keymessage'\n}, // Webkit-prefixed (early Chrome versions and Chrome with EME disabled in chrome://flags)\n{\n  // Video Element\n  generateKeyRequest: 'webkitGenerateKeyRequest',\n  addKey: 'webkitAddKey',\n  cancelKeyRequest: 'webkitCancelKeyRequest',\n  // Events\n  needkey: 'webkitneedkey',\n  keyerror: 'webkitkeyerror',\n  keyadded: 'webkitkeyadded',\n  keymessage: 'webkitkeymessage'\n}];\n/**\n* The copyright in this software is being made available under the BSD License,\n* included below. This software may be subject to other third party and contributor\n* rights, including patent rights, and no such rights are granted under this license.\n*\n* Copyright (c) 2013, Dash Industry Forum.\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without modification,\n* are permitted provided that the following conditions are met:\n*  * Redistributions of source code must retain the above copyright notice, this\n*  list of conditions and the following disclaimer.\n*  * Redistributions in binary form must reproduce the above copyright notice,\n*  this list of conditions and the following disclaimer in the documentation and/or\n*  other materials provided with the distribution.\n*  * Neither the name of Dash Industry Forum nor the names of its\n*  contributors may be used to endorse or promote products derived from this software\n*  without specific prior written permission.\n*\n*  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n*  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n*  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n*  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n*  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n*  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n*  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n*  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n*  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n*  POSSIBILITY OF SUCH DAMAGE.\n*/\n\nvar APIS_ProtectionModel_3Feb2014 = [// Un-prefixed as per spec\n// Chrome 38-39 (and some earlier versions) with chrome://flags -- Enable Encrypted Media Extensions\n{\n  // Video Element\n  setMediaKeys: 'setMediaKeys',\n  // MediaKeys\n  MediaKeys: 'MediaKeys',\n  // MediaKeySession\n  release: 'close',\n  // Events\n  needkey: 'needkey',\n  error: 'keyerror',\n  message: 'keymessage',\n  ready: 'keyadded',\n  close: 'keyclose'\n}, // MS-prefixed (IE11, Windows 8.1)\n{\n  // Video Element\n  setMediaKeys: 'msSetMediaKeys',\n  // MediaKeys\n  MediaKeys: 'MSMediaKeys',\n  // MediaKeySession\n  release: 'close',\n  // Events\n  needkey: 'msneedkey',\n  error: 'mskeyerror',\n  message: 'mskeymessage',\n  ready: 'mskeyadded',\n  close: 'mskeyclose'\n}];\n\nfunction Protection() {\n  var instance = void 0;\n  var context = this.context;\n  /**\n  * Create a ProtectionController and associated ProtectionModel for use with\n  * a single piece of content.\n  *\n  * @param {Object} config\n  * @return {ProtectionController} protection controller\n  *\n  */\n\n  function createProtectionSystem(config) {\n    var controller = null;\n    var protectionKeyController = (0, _ProtectionKeyController2.default)(context).getInstance();\n    protectionKeyController.setConfig({\n      debug: config.debug,\n      BASE64: config.BASE64\n    });\n    protectionKeyController.initialize();\n    var protectionModel = getProtectionModel(config);\n\n    if (!controller && protectionModel) {\n      //TODO add ability to set external controller if still needed at all?\n      controller = (0, _ProtectionController2.default)(context).create({\n        protectionModel: protectionModel,\n        protectionKeyController: protectionKeyController,\n        eventBus: config.eventBus,\n        debug: config.debug,\n        events: config.events,\n        BASE64: config.BASE64,\n        constants: config.constants,\n        cmcdModel: config.cmcdModel,\n        settings: config.settings\n      });\n      config.capabilities.setEncryptedMediaSupported(true);\n    }\n\n    return controller;\n  }\n\n  function getProtectionModel(config) {\n    var debug = config.debug;\n    var logger = debug.getLogger(instance);\n    var eventBus = config.eventBus;\n    var errHandler = config.errHandler;\n    var videoElement = config.videoModel ? config.videoModel.getElement() : null;\n\n    if ((!videoElement || videoElement.onencrypted !== undefined) && (!videoElement || videoElement.mediaKeys !== undefined)) {\n      logger.info('EME detected on this user agent! (ProtectionModel_21Jan2015)');\n      return (0, _ProtectionModel_21Jan2.default)(context).create({\n        debug: debug,\n        eventBus: eventBus,\n        events: config.events\n      });\n    } else if (getAPI(videoElement, APIS_ProtectionModel_3Feb2014)) {\n      logger.info('EME detected on this user agent! (ProtectionModel_3Feb2014)');\n      return (0, _ProtectionModel_3Feb2.default)(context).create({\n        debug: debug,\n        eventBus: eventBus,\n        events: config.events,\n        api: getAPI(videoElement, APIS_ProtectionModel_3Feb2014)\n      });\n    } else if (getAPI(videoElement, APIS_ProtectionModel_01b)) {\n      logger.info('EME detected on this user agent! (ProtectionModel_01b)');\n      return (0, _ProtectionModel_01b2.default)(context).create({\n        debug: debug,\n        eventBus: eventBus,\n        errHandler: errHandler,\n        events: config.events,\n        api: getAPI(videoElement, APIS_ProtectionModel_01b)\n      });\n    } else {\n      logger.warn('No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!');\n      return null;\n    }\n  }\n\n  function getAPI(videoElement, apis) {\n    for (var i = 0; i < apis.length; i++) {\n      var api = apis[i]; // detect if api is supported by browser\n      // check only first function in api -> should be fine\n\n      if (typeof videoElement[api[Object.keys(api)[0]]] !== 'function') {\n        continue;\n      }\n\n      return api;\n    }\n\n    return null;\n  }\n\n  instance = {\n    createProtectionSystem: createProtectionSystem\n  };\n  return instance;\n}\n\nProtection.__dashjs_factory_name = 'Protection';\nvar factory = dashjs.FactoryMaker.getClassFactory(Protection);\n/* jshint ignore:line */\n\nfactory.events = _ProtectionEvents2.default;\nfactory.errors = _ProtectionErrors2.default;\ndashjs.FactoryMaker.updateClassFactory(Protection.__dashjs_factory_name, factory);\n/* jshint ignore:line */\n\nexports.default = factory;","map":{"version":3,"sources":["../../../../../src/streaming/protection/Protection.js"],"names":["APIS_ProtectionModel_01b","generateKeyRequest","addKey","cancelKeyRequest","needkey","keyerror","keyadded","keymessage","APIS_ProtectionModel_3Feb2014","setMediaKeys","MediaKeys","release","error","message","ready","close","instance","context","controller","protectionKeyController","debug","config","BASE64","protectionModel","getProtectionModel","eventBus","events","constants","cmcdModel","settings","logger","errHandler","videoElement","getAPI","api","i","apis","Object","createProtectionSystem","Protection","factory","dashjs","ProtectionEvents","ProtectionErrors"],"mappings":";;;;;;AA8BA,IAAA,qBAAA,GAAA,OAAA,CAAA,oCAAA,CAAA;;;;AACA,IAAA,wBAAA,GAAA,OAAA,CAAA,uCAAA,CAAA;;;;AACA,IAAA,iBAAA,GAAA,OAAA,CAAA,oBAAA,CAAA;;;;AACA,IAAA,iBAAA,GAAA,OAAA,CAAA,2BAAA,CAAA;;;;AACA,IAAA,sBAAA,GAAA,OAAA,CAAA,oCAAA,CAAA;;;;AACA,IAAA,qBAAA,GAAA,OAAA,CAAA,mCAAA,CAAA;;;;AACA,IAAA,oBAAA,GAAA,OAAA,CAAA,8BAAA,CAAA;;;;;;;;AAEA;;AAAA,IAAMA,wBAAAA,GAA2B,CAC7B;AACA;AACI;AACAC,EAAAA,kBAAAA,EAFJ,oBAAA;AAGIC,EAAAA,MAAAA,EAHJ,QAAA;AAIIC,EAAAA,gBAAAA,EAJJ,kBAAA;AAMI;AACAC,EAAAA,OAAAA,EAPJ,SAAA;AAQIC,EAAAA,QAAAA,EARJ,UAAA;AASIC,EAAAA,QAAAA,EATJ,UAAA;AAUIC,EAAAA,UAAAA,EAZyB;AAE7B,CAF6B,EAc7B;AACA;AACI;AACAN,EAAAA,kBAAAA,EAFJ,0BAAA;AAGIC,EAAAA,MAAAA,EAHJ,cAAA;AAIIC,EAAAA,gBAAAA,EAJJ,wBAAA;AAMI;AACAC,EAAAA,OAAAA,EAPJ,eAAA;AAQIC,EAAAA,QAAAA,EARJ,gBAAA;AASIC,EAAAA,QAAAA,EATJ,gBAAA;AAUIC,EAAAA,UAAAA,EAzBR;AAeI,CAf6B,CAAjC;AAtCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmEA,IAAMC,6BAAAA,GAAgC,CAClC;AACA;AACA;AACI;AACAC,EAAAA,YAAAA,EAFJ,cAAA;AAGI;AACAC,EAAAA,SAAAA,EAJJ,WAAA;AAKI;AACAC,EAAAA,OAAAA,EANJ,OAAA;AAQI;AACAP,EAAAA,OAAAA,EATJ,SAAA;AAUIQ,EAAAA,KAAAA,EAVJ,UAAA;AAWIC,EAAAA,OAAAA,EAXJ,YAAA;AAYIC,EAAAA,KAAAA,EAZJ,UAAA;AAaIC,EAAAA,KAAAA,EAhB8B;AAGlC,CAHkC,EAkBlC;AACA;AACI;AACAN,EAAAA,YAAAA,EAFJ,gBAAA;AAGI;AACAC,EAAAA,SAAAA,EAJJ,aAAA;AAKI;AACAC,EAAAA,OAAAA,EANJ,OAAA;AAOI;AACAP,EAAAA,OAAAA,EARJ,WAAA;AASIQ,EAAAA,KAAAA,EATJ,YAAA;AAUIC,EAAAA,OAAAA,EAVJ,cAAA;AAWIC,EAAAA,KAAAA,EAXJ,YAAA;AAYIC,EAAAA,KAAAA,EA/BR;AAmBI,CAnBkC,CAAtC;;AAmCA,SAAA,UAAA,GAAsB;AAClB,MAAIC,QAAAA,GAAAA,KAAJ,CAAA;AACA,MAAMC,OAAAA,GAAU,KAAhB,OAAA;AAEA;;;;;;;;;AAQA,WAAA,sBAAA,CAAA,MAAA,EAAwC;AACpC,QAAIC,UAAAA,GAAJ,IAAA;AAEA,QAAMC,uBAAAA,GAA0B,CAAA,GAAA,yBAAA,CAAA,OAAA,EAAA,OAAA,EAAhC,WAAgC,EAAhC;AACAA,IAAAA,uBAAAA,CAAAA,SAAAA,CAAkC;AAAEC,MAAAA,KAAAA,EAAOC,MAAAA,CAAT,KAAA;AAAuBC,MAAAA,MAAAA,EAAQD,MAAAA,CAAjEF;AAAkC,KAAlCA;AACAA,IAAAA,uBAAAA,CAAAA,UAAAA;AAEA,QAAII,eAAAA,GAAmBC,kBAAAA,CAAvB,MAAuBA,CAAvB;;AAEA,QAAI,CAAA,UAAA,IAAJ,eAAA,EAAoC;AAAC;AACjCN,MAAAA,UAAAA,GAAa,CAAA,GAAA,sBAAA,CAAA,OAAA,EAAA,OAAA,EAAA,MAAA,CAAqC;AAC9CK,QAAAA,eAAAA,EAD8C,eAAA;AAE9CJ,QAAAA,uBAAAA,EAF8C,uBAAA;AAG9CM,QAAAA,QAAAA,EAAUJ,MAAAA,CAHoC,QAAA;AAI9CD,QAAAA,KAAAA,EAAOC,MAAAA,CAJuC,KAAA;AAK9CK,QAAAA,MAAAA,EAAQL,MAAAA,CALsC,MAAA;AAM9CC,QAAAA,MAAAA,EAAQD,MAAAA,CANsC,MAAA;AAO9CM,QAAAA,SAAAA,EAAWN,MAAAA,CAPmC,SAAA;AAQ9CO,QAAAA,SAAAA,EAAWP,MAAAA,CARmC,SAAA;AAS9CQ,QAAAA,QAAAA,EAAUR,MAAAA,CATdH;AAAkD,OAArC,CAAbA;AAWAG,MAAAA,MAAAA,CAAAA,YAAAA,CAAAA,0BAAAA,CAAAA,IAAAA;AAEJ;;AAAA,WAAA,UAAA;AAGJ;;AAAA,WAAA,kBAAA,CAAA,MAAA,EAAoC;AAChC,QAAMD,KAAAA,GAAQC,MAAAA,CAAd,KAAA;AACA,QAAMS,MAAAA,GAASV,KAAAA,CAAAA,SAAAA,CAAf,QAAeA,CAAf;AACA,QAAMK,QAAAA,GAAWJ,MAAAA,CAAjB,QAAA;AACA,QAAMU,UAAAA,GAAaV,MAAAA,CAAnB,UAAA;AACA,QAAMW,YAAAA,GAAeX,MAAAA,CAAAA,UAAAA,GAAoBA,MAAAA,CAAAA,UAAAA,CAApBA,UAAoBA,EAApBA,GAArB,IAAA;;AAEA,QAAI,CAAC,CAAA,YAAA,IAAiBW,YAAAA,CAAAA,WAAAA,KAAlB,SAAA,MACC,CAAA,YAAA,IAAiBA,YAAAA,CAAAA,SAAAA,KADtB,SAAI,CAAJ,EAC6D;AACzDF,MAAAA,MAAAA,CAAAA,IAAAA,CAAAA,8DAAAA;AACA,aAAO,CAAA,GAAA,uBAAA,CAAA,OAAA,EAAA,OAAA,EAAA,MAAA,CAA0C;AAAEV,QAAAA,KAAAA,EAAF,KAAA;AAAgBK,QAAAA,QAAAA,EAAhB,QAAA;AAAoCC,QAAAA,MAAAA,EAAQL,MAAAA,CAA7F;AAAiD,OAA1C,CAAP;AAHJ,KAAA,MAIO,IAAIY,MAAAA,CAAAA,YAAAA,EAAJ,6BAAIA,CAAJ,EAAyD;AAC5DH,MAAAA,MAAAA,CAAAA,IAAAA,CAAAA,6DAAAA;AACA,aAAO,CAAA,GAAA,sBAAA,CAAA,OAAA,EAAA,OAAA,EAAA,MAAA,CAAyC;AAAEV,QAAAA,KAAAA,EAAF,KAAA;AAAgBK,QAAAA,QAAAA,EAAhB,QAAA;AAAoCC,QAAAA,MAAAA,EAAQL,MAAAA,CAA5C,MAAA;AAA2Da,QAAAA,GAAAA,EAAKD,MAAAA,CAAAA,YAAAA,EAAhH,6BAAgHA;AAAhE,OAAzC,CAAP;AAFG,KAAA,MAGA,IAAIA,MAAAA,CAAAA,YAAAA,EAAJ,wBAAIA,CAAJ,EAAoD;AACvDH,MAAAA,MAAAA,CAAAA,IAAAA,CAAAA,wDAAAA;AACA,aAAO,CAAA,GAAA,qBAAA,CAAA,OAAA,EAAA,OAAA,EAAA,MAAA,CAAoC;AAAEV,QAAAA,KAAAA,EAAF,KAAA;AAAgBK,QAAAA,QAAAA,EAAhB,QAAA;AAAoCM,QAAAA,UAAAA,EAApC,UAAA;AAA4DL,QAAAA,MAAAA,EAAQL,MAAAA,CAApE,MAAA;AAAmFa,QAAAA,GAAAA,EAAKD,MAAAA,CAAAA,YAAAA,EAAnI,wBAAmIA;AAAxF,OAApC,CAAP;AAFG,KAAA,MAGA;AACHH,MAAAA,MAAAA,CAAAA,IAAAA,CAAAA,0GAAAA;AACA,aAAA,IAAA;AAEP;AAED;;AAAA,WAAA,MAAA,CAAA,YAAA,EAAA,IAAA,EAAoC;AAChC,SAAK,IAAIK,CAAAA,GAAT,CAAA,EAAgBA,CAAAA,GAAIC,IAAAA,CAApB,MAAA,EAAiCD,CAAjC,EAAA,EAAsC;AAClC,UAAMD,GAAAA,GAAME,IAAAA,CAAZ,CAAYA,CAAZ,CADkC,CAElC;AACA;;AACA,UAAI,OAAOJ,YAAAA,CAAaE,GAAAA,CAAIG,MAAAA,CAAAA,IAAAA,CAAAA,GAAAA,EAAxB,CAAwBA,CAAJH,CAAbF,CAAP,KAAJ,UAAA,EAAkE;AAC9D;AAGJ;;AAAA,aAAA,GAAA;AAGJ;;AAAA,WAAA,IAAA;AAGJhB;;AAAAA,EAAAA,QAAAA,GAAW;AACPsB,IAAAA,sBAAAA,EADJtB;AAAW,GAAXA;AAIA,SAAA,QAAA;AAGJuB;;AAAAA,UAAAA,CAAAA,qBAAAA,GAAAA,YAAAA;AACA,IAAMC,OAAAA,GAAUC,MAAAA,CAAAA,YAAAA,CAAAA,eAAAA,CAAhB,UAAgBA,CAAhB;AAAiE;;AACjED,OAAAA,CAAAA,MAAAA,GAAiBE,kBAAAA,CAAjBF,OAAAA;AACAA,OAAAA,CAAAA,MAAAA,GAAiBG,kBAAAA,CAAjBH,OAAAA;AACAC,MAAAA,CAAAA,YAAAA,CAAAA,kBAAAA,CAAuCF,UAAAA,CAAvCE,qBAAAA,EAAAA,OAAAA;AAAmF;;kBACpED,O","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport ProtectionController from './controllers/ProtectionController';\nimport ProtectionKeyController from './controllers/ProtectionKeyController';\nimport ProtectionEvents from './ProtectionEvents';\nimport ProtectionErrors from './errors/ProtectionErrors';\nimport ProtectionModel_21Jan2015 from './models/ProtectionModel_21Jan2015';\nimport ProtectionModel_3Feb2014 from './models/ProtectionModel_3Feb2014';\nimport ProtectionModel_01b from './models/ProtectionModel_01b';\n\nconst APIS_ProtectionModel_01b = [\n    // Un-prefixed as per spec\n    {\n        // Video Element\n        generateKeyRequest: 'generateKeyRequest',\n        addKey: 'addKey',\n        cancelKeyRequest: 'cancelKeyRequest',\n\n        // Events\n        needkey: 'needkey',\n        keyerror: 'keyerror',\n        keyadded: 'keyadded',\n        keymessage: 'keymessage'\n    },\n    // Webkit-prefixed (early Chrome versions and Chrome with EME disabled in chrome://flags)\n    {\n        // Video Element\n        generateKeyRequest: 'webkitGenerateKeyRequest',\n        addKey: 'webkitAddKey',\n        cancelKeyRequest: 'webkitCancelKeyRequest',\n\n        // Events\n        needkey: 'webkitneedkey',\n        keyerror: 'webkitkeyerror',\n        keyadded: 'webkitkeyadded',\n        keymessage: 'webkitkeymessage'\n    }\n];\n\nconst APIS_ProtectionModel_3Feb2014 = [\n    // Un-prefixed as per spec\n    // Chrome 38-39 (and some earlier versions) with chrome://flags -- Enable Encrypted Media Extensions\n    {\n        // Video Element\n        setMediaKeys: 'setMediaKeys',\n        // MediaKeys\n        MediaKeys: 'MediaKeys',\n        // MediaKeySession\n        release: 'close',\n\n        // Events\n        needkey: 'needkey',\n        error: 'keyerror',\n        message: 'keymessage',\n        ready: 'keyadded',\n        close: 'keyclose'\n    },\n    // MS-prefixed (IE11, Windows 8.1)\n    {\n        // Video Element\n        setMediaKeys: 'msSetMediaKeys',\n        // MediaKeys\n        MediaKeys: 'MSMediaKeys',\n        // MediaKeySession\n        release: 'close',\n        // Events\n        needkey: 'msneedkey',\n        error: 'mskeyerror',\n        message: 'mskeymessage',\n        ready: 'mskeyadded',\n        close: 'mskeyclose'\n    }\n];\n\nfunction Protection() {\n    let instance;\n    const context = this.context;\n\n    /**\n     * Create a ProtectionController and associated ProtectionModel for use with\n     * a single piece of content.\n     *\n     * @param {Object} config\n     * @return {ProtectionController} protection controller\n     *\n     */\n    function createProtectionSystem(config) {\n        let controller = null;\n\n        const protectionKeyController = ProtectionKeyController(context).getInstance();\n        protectionKeyController.setConfig({ debug: config.debug, BASE64: config.BASE64 });\n        protectionKeyController.initialize();\n\n        let protectionModel =  getProtectionModel(config);\n\n        if (!controller && protectionModel) {//TODO add ability to set external controller if still needed at all?\n            controller = ProtectionController(context).create({\n                protectionModel: protectionModel,\n                protectionKeyController: protectionKeyController,\n                eventBus: config.eventBus,\n                debug: config.debug,\n                events: config.events,\n                BASE64: config.BASE64,\n                constants: config.constants,\n                cmcdModel: config.cmcdModel,\n                settings: config.settings\n            });\n            config.capabilities.setEncryptedMediaSupported(true);\n        }\n        return controller;\n    }\n\n    function getProtectionModel(config) {\n        const debug = config.debug;\n        const logger = debug.getLogger(instance);\n        const eventBus = config.eventBus;\n        const errHandler = config.errHandler;\n        const videoElement = config.videoModel ? config.videoModel.getElement() : null;\n\n        if ((!videoElement || videoElement.onencrypted !== undefined) &&\n            (!videoElement || videoElement.mediaKeys !== undefined)) {\n            logger.info('EME detected on this user agent! (ProtectionModel_21Jan2015)');\n            return ProtectionModel_21Jan2015(context).create({ debug: debug, eventBus: eventBus, events: config.events });\n        } else if (getAPI(videoElement, APIS_ProtectionModel_3Feb2014)) {\n            logger.info('EME detected on this user agent! (ProtectionModel_3Feb2014)');\n            return ProtectionModel_3Feb2014(context).create({ debug: debug, eventBus: eventBus, events: config.events, api: getAPI(videoElement, APIS_ProtectionModel_3Feb2014) });\n        } else if (getAPI(videoElement, APIS_ProtectionModel_01b)) {\n            logger.info('EME detected on this user agent! (ProtectionModel_01b)');\n            return ProtectionModel_01b(context).create({ debug: debug, eventBus: eventBus, errHandler: errHandler, events: config.events, api: getAPI(videoElement, APIS_ProtectionModel_01b) });\n        } else {\n            logger.warn('No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!');\n            return null;\n        }\n    }\n\n    function getAPI(videoElement, apis) {\n        for (let i = 0; i < apis.length; i++) {\n            const api = apis[i];\n            // detect if api is supported by browser\n            // check only first function in api -> should be fine\n            if (typeof videoElement[api[Object.keys(api)[0]]] !== 'function') {\n                continue;\n            }\n\n            return api;\n        }\n\n        return null;\n    }\n\n    instance = {\n        createProtectionSystem: createProtectionSystem\n    };\n\n    return instance;\n}\n\nProtection.__dashjs_factory_name = 'Protection';\nconst factory = dashjs.FactoryMaker.getClassFactory(Protection); /* jshint ignore:line */\nfactory.events = ProtectionEvents;\nfactory.errors = ProtectionErrors;\ndashjs.FactoryMaker.updateClassFactory(Protection.__dashjs_factory_name, factory); /* jshint ignore:line */\nexport default factory;\n"]},"metadata":{},"sourceType":"script"}