{"ast":null,"code":"/* \r\n * Copyright (c) 2016, Pierre-Anthony Lemieux <pal@sandflow.com>\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *\r\n * * Redistributions of source code must retain the above copyright notice, this\r\n *   list of conditions and the following disclaimer.\r\n * * Redistributions in binary form must reproduce the above copyright notice,\r\n *   this list of conditions and the following disclaimer in the documentation\r\n *   and/or other materials provided with the distribution.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\r\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\r\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\r\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\r\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\r\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\r\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\r\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n * POSSIBILITY OF SUCH DAMAGE.\r\n */\n\n/**\r\n * @module imscStyles\r\n */\n;\n\n(function (imscStyles, imscNames, imscUtils) {\n  // wrapper for non-node envs\n  function StylingAttributeDefinition(ns, name, initialValue, appliesTo, isInherit, isAnimatable, parseFunc, computeFunc) {\n    this.name = name;\n    this.ns = ns;\n    this.qname = ns + \" \" + name;\n    this.inherit = isInherit;\n    this.animatable = isAnimatable;\n    this.initial = initialValue;\n    this.applies = appliesTo;\n    this.parse = parseFunc;\n    this.compute = computeFunc;\n  }\n\n  imscStyles.all = [new StylingAttributeDefinition(imscNames.ns_tts, \"backgroundColor\", \"transparent\", ['body', 'div', 'p', 'region', 'span'], false, true, imscUtils.parseColor, null), new StylingAttributeDefinition(imscNames.ns_tts, \"color\", \"white\", ['span'], true, true, imscUtils.parseColor, null), new StylingAttributeDefinition(imscNames.ns_tts, \"direction\", \"ltr\", ['p', 'span'], true, true, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"display\", \"auto\", ['body', 'div', 'p', 'region', 'span'], false, true, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"displayAlign\", \"before\", ['region'], false, true, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"extent\", \"auto\", ['tt', 'region'], false, true, function (str) {\n    if (str === \"auto\") {\n      return str;\n    } else {\n      var s = str.split(\" \");\n      if (s.length !== 2) return null;\n      var w = imscUtils.parseLength(s[0]);\n      var h = imscUtils.parseLength(s[1]);\n      if (!h || !w) return null;\n      return {\n        'h': h,\n        'w': w\n      };\n    }\n  }, function (doc, parent, element, attr, context) {\n    var h;\n    var w;\n\n    if (attr === \"auto\") {\n      h = new imscUtils.ComputedLength(0, 1);\n    } else {\n      h = imscUtils.toComputedLength(attr.h.value, attr.h.unit, null, doc.dimensions.h, null, doc.pxLength.h);\n\n      if (h === null) {\n        return null;\n      }\n    }\n\n    if (attr === \"auto\") {\n      w = new imscUtils.ComputedLength(1, 0);\n    } else {\n      w = imscUtils.toComputedLength(attr.w.value, attr.w.unit, null, doc.dimensions.w, null, doc.pxLength.w);\n\n      if (w === null) {\n        return null;\n      }\n    }\n\n    return {\n      'h': h,\n      'w': w\n    };\n  }), new StylingAttributeDefinition(imscNames.ns_tts, \"fontFamily\", \"default\", ['span', 'p'], true, true, function (str) {\n    var ffs = str.split(\",\");\n    var rslt = [];\n\n    for (var i in ffs) {\n      if (ffs[i].charAt(0) !== \"'\" && ffs[i].charAt(0) !== '\"') {\n        if (ffs[i] === \"default\") {\n          /* per IMSC1 */\n          rslt.push(\"monospaceSerif\");\n        } else {\n          rslt.push(ffs[i]);\n        }\n      } else {\n        rslt.push(ffs[i]);\n      }\n    }\n\n    return rslt;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"shear\", \"0%\", ['p'], true, true, imscUtils.parseLength, function (doc, parent, element, attr) {\n    var fs;\n\n    if (attr.unit === \"%\") {\n      fs = Math.abs(attr.value) > 100 ? Math.sign(attr.value) * 100 : attr.value;\n    } else {\n      return null;\n    }\n\n    return fs;\n  }), new StylingAttributeDefinition(imscNames.ns_tts, \"fontSize\", \"1c\", ['span', 'p'], true, true, imscUtils.parseLength, function (doc, parent, element, attr, context) {\n    var fs;\n    fs = imscUtils.toComputedLength(attr.value, attr.unit, parent !== null ? parent.styleAttrs[imscStyles.byName.fontSize.qname] : doc.cellLength.h, parent !== null ? parent.styleAttrs[imscStyles.byName.fontSize.qname] : doc.cellLength.h, doc.cellLength.h, doc.pxLength.h);\n    return fs;\n  }), new StylingAttributeDefinition(imscNames.ns_tts, \"fontStyle\", \"normal\", ['span', 'p'], true, true, function (str) {\n    /* TODO: handle font style */\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"fontWeight\", \"normal\", ['span', 'p'], true, true, function (str) {\n    /* TODO: handle font weight */\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"lineHeight\", \"normal\", ['p'], true, true, function (str) {\n    if (str === \"normal\") {\n      return str;\n    } else {\n      return imscUtils.parseLength(str);\n    }\n  }, function (doc, parent, element, attr, context) {\n    var lh;\n\n    if (attr === \"normal\") {\n      /* inherit normal per https://github.com/w3c/ttml1/issues/220 */\n      lh = attr;\n    } else {\n      lh = imscUtils.toComputedLength(attr.value, attr.unit, element.styleAttrs[imscStyles.byName.fontSize.qname], element.styleAttrs[imscStyles.byName.fontSize.qname], doc.cellLength.h, doc.pxLength.h);\n\n      if (lh === null) {\n        return null;\n      }\n    }\n    /* TODO: create a Length constructor */\n\n\n    return lh;\n  }), new StylingAttributeDefinition(imscNames.ns_tts, \"opacity\", 1.0, ['region'], false, true, parseFloat, null), new StylingAttributeDefinition(imscNames.ns_tts, \"origin\", \"auto\", ['region'], false, true, function (str) {\n    if (str === \"auto\") {\n      return str;\n    } else {\n      var s = str.split(\" \");\n      if (s.length !== 2) return null;\n      var w = imscUtils.parseLength(s[0]);\n      var h = imscUtils.parseLength(s[1]);\n      if (!h || !w) return null;\n      return {\n        'h': h,\n        'w': w\n      };\n    }\n  }, function (doc, parent, element, attr, context) {\n    var h;\n    var w;\n\n    if (attr === \"auto\") {\n      h = new imscUtils.ComputedLength(0, 0);\n    } else {\n      h = imscUtils.toComputedLength(attr.h.value, attr.h.unit, null, doc.dimensions.h, null, doc.pxLength.h);\n\n      if (h === null) {\n        return null;\n      }\n    }\n\n    if (attr === \"auto\") {\n      w = new imscUtils.ComputedLength(0, 0);\n    } else {\n      w = imscUtils.toComputedLength(attr.w.value, attr.w.unit, null, doc.dimensions.w, null, doc.pxLength.w);\n\n      if (w === null) {\n        return null;\n      }\n    }\n\n    return {\n      'h': h,\n      'w': w\n    };\n  }), new StylingAttributeDefinition(imscNames.ns_tts, \"overflow\", \"hidden\", ['region'], false, true, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"padding\", \"0px\", ['region'], false, true, function (str) {\n    var s = str.split(\" \");\n    if (s.length > 4) return null;\n    var r = [];\n\n    for (var i in s) {\n      var l = imscUtils.parseLength(s[i]);\n      if (!l) return null;\n      r.push(l);\n    }\n\n    return r;\n  }, function (doc, parent, element, attr, context) {\n    var padding;\n    /* TODO: make sure we are in region */\n\n    /*\r\n     * expand padding shortcuts to \r\n     * [before, end, after, start]\r\n     * \r\n     */\n\n    if (attr.length === 1) {\n      padding = [attr[0], attr[0], attr[0], attr[0]];\n    } else if (attr.length === 2) {\n      padding = [attr[0], attr[1], attr[0], attr[1]];\n    } else if (attr.length === 3) {\n      padding = [attr[0], attr[1], attr[2], attr[1]];\n    } else if (attr.length === 4) {\n      padding = [attr[0], attr[1], attr[2], attr[3]];\n    } else {\n      return null;\n    }\n    /* TODO: take into account tts:direction */\n\n    /* \r\n     * transform [before, end, after, start] according to writingMode to \r\n     * [top,left,bottom,right]\r\n     * \r\n     */\n\n\n    var dir = element.styleAttrs[imscStyles.byName.writingMode.qname];\n\n    if (dir === \"lrtb\" || dir === \"lr\") {\n      padding = [padding[0], padding[3], padding[2], padding[1]];\n    } else if (dir === \"rltb\" || dir === \"rl\") {\n      padding = [padding[0], padding[1], padding[2], padding[3]];\n    } else if (dir === \"tblr\") {\n      padding = [padding[3], padding[0], padding[1], padding[2]];\n    } else if (dir === \"tbrl\" || dir === \"tb\") {\n      padding = [padding[3], padding[2], padding[1], padding[0]];\n    } else {\n      return null;\n    }\n\n    var out = [];\n\n    for (var i in padding) {\n      if (padding[i].value === 0) {\n        out[i] = new imscUtils.ComputedLength(0, 0);\n      } else {\n        out[i] = imscUtils.toComputedLength(padding[i].value, padding[i].unit, element.styleAttrs[imscStyles.byName.fontSize.qname], i === \"0\" || i === \"2\" ? element.styleAttrs[imscStyles.byName.extent.qname].h : element.styleAttrs[imscStyles.byName.extent.qname].w, i === \"0\" || i === \"2\" ? doc.cellLength.h : doc.cellLength.w, i === \"0\" || i === \"2\" ? doc.pxLength.h : doc.pxLength.w);\n        if (out[i] === null) return null;\n      }\n    }\n\n    return out;\n  }), new StylingAttributeDefinition(imscNames.ns_tts, \"position\", \"top left\", ['region'], false, true, function (str) {\n    return imscUtils.parsePosition(str);\n  }, function (doc, parent, element, attr) {\n    var h;\n    var w;\n    h = imscUtils.toComputedLength(attr.v.offset.value, attr.v.offset.unit, null, new imscUtils.ComputedLength(-element.styleAttrs[imscStyles.byName.extent.qname].h.rw, doc.dimensions.h.rh - element.styleAttrs[imscStyles.byName.extent.qname].h.rh), null, doc.pxLength.h);\n    if (h === null) return null;\n\n    if (attr.v.edge === \"bottom\") {\n      h = new imscUtils.ComputedLength(-h.rw - element.styleAttrs[imscStyles.byName.extent.qname].h.rw, doc.dimensions.h.rh - h.rh - element.styleAttrs[imscStyles.byName.extent.qname].h.rh);\n    }\n\n    w = imscUtils.toComputedLength(attr.h.offset.value, attr.h.offset.unit, null, new imscUtils.ComputedLength(doc.dimensions.w.rw - element.styleAttrs[imscStyles.byName.extent.qname].w.rw, -element.styleAttrs[imscStyles.byName.extent.qname].w.rh), null, doc.pxLength.w);\n    if (h === null) return null;\n\n    if (attr.h.edge === \"right\") {\n      w = new imscUtils.ComputedLength(doc.dimensions.w.rw - w.rw - element.styleAttrs[imscStyles.byName.extent.qname].w.rw, -w.rh - element.styleAttrs[imscStyles.byName.extent.qname].w.rh);\n    }\n\n    return {\n      'h': h,\n      'w': w\n    };\n  }), new StylingAttributeDefinition(imscNames.ns_tts, \"ruby\", \"none\", ['span'], false, true, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"rubyAlign\", \"center\", ['span'], true, true, function (str) {\n    if (!(str === \"center\" || str === \"spaceAround\")) {\n      return null;\n    }\n\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"rubyPosition\", \"outside\", ['span'], true, true, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"rubyReserve\", \"none\", ['p'], true, true, function (str) {\n    var s = str.split(\" \");\n    var r = [null, null];\n    if (s.length === 0 || s.length > 2) return null;\n\n    if (s[0] === \"none\" || s[0] === \"both\" || s[0] === \"after\" || s[0] === \"before\" || s[0] === \"outside\") {\n      r[0] = s[0];\n    } else {\n      return null;\n    }\n\n    if (s.length === 2 && s[0] !== \"none\") {\n      var l = imscUtils.parseLength(s[1]);\n\n      if (l) {\n        r[1] = l;\n      } else {\n        return null;\n      }\n    }\n\n    return r;\n  }, function (doc, parent, element, attr, context) {\n    if (attr[0] === \"none\") {\n      return attr;\n    }\n\n    var fs = null;\n\n    if (attr[1] === null) {\n      fs = new imscUtils.ComputedLength(element.styleAttrs[imscStyles.byName.fontSize.qname].rw * 0.5, element.styleAttrs[imscStyles.byName.fontSize.qname].rh * 0.5);\n    } else {\n      fs = imscUtils.toComputedLength(attr[1].value, attr[1].unit, element.styleAttrs[imscStyles.byName.fontSize.qname], element.styleAttrs[imscStyles.byName.fontSize.qname], doc.cellLength.h, doc.pxLength.h);\n    }\n\n    if (fs === null) return null;\n    return [attr[0], fs];\n  }), new StylingAttributeDefinition(imscNames.ns_tts, \"showBackground\", \"always\", ['region'], false, true, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"textAlign\", \"start\", ['p'], true, true, function (str) {\n    return str;\n  }, function (doc, parent, element, attr, context) {\n    /* Section 7.16.9 of XSL */\n    if (attr === \"left\") {\n      return \"start\";\n    } else if (attr === \"right\") {\n      return \"end\";\n    } else {\n      return attr;\n    }\n  }), new StylingAttributeDefinition(imscNames.ns_tts, \"textCombine\", \"none\", ['span'], true, true, function (str) {\n    if (str === \"none\" || str === \"all\") {\n      return str;\n    }\n\n    return null;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"textDecoration\", \"none\", ['span'], true, true, function (str) {\n    return str.split(\" \");\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"textEmphasis\", \"none\", ['span'], true, true, function (str) {\n    var e = str.split(\" \");\n    var rslt = {\n      style: null,\n      symbol: null,\n      color: null,\n      position: null\n    };\n\n    for (var i in e) {\n      if (e[i] === \"none\" || e[i] === \"auto\") {\n        rslt.style = e[i];\n      } else if (e[i] === \"filled\" || e[i] === \"open\") {\n        rslt.style = e[i];\n      } else if (e[i] === \"circle\" || e[i] === \"dot\" || e[i] === \"sesame\") {\n        rslt.symbol = e[i];\n      } else if (e[i] === \"current\") {\n        rslt.color = e[i];\n      } else if (e[i] === \"outside\" || e[i] === \"before\" || e[i] === \"after\") {\n        rslt.position = e[i];\n      } else {\n        rslt.color = imscUtils.parseColor(e[i]);\n        if (rslt.color === null) return null;\n      }\n    }\n\n    if (rslt.style == null && rslt.symbol == null) {\n      rslt.style = \"auto\";\n    } else {\n      rslt.symbol = rslt.symbol || \"circle\";\n      rslt.style = rslt.style || \"filled\";\n    }\n\n    rslt.position = rslt.position || \"outside\";\n    rslt.color = rslt.color || \"current\";\n    return rslt;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"textOutline\", \"none\", ['span'], true, true, function (str) {\n    /*\r\n     * returns {c: <color>?, thichness: <length>} | \"none\"\r\n     * \r\n     */\n    if (str === \"none\") {\n      return str;\n    } else {\n      var r = {};\n      var s = str.split(\" \");\n      if (s.length === 0 || s.length > 2) return null;\n      var c = imscUtils.parseColor(s[0]);\n      r.color = c;\n      if (c !== null) s.shift();\n      if (s.length !== 1) return null;\n      var l = imscUtils.parseLength(s[0]);\n      if (!l) return null;\n      r.thickness = l;\n      return r;\n    }\n  }, function (doc, parent, element, attr, context) {\n    /*\r\n     * returns {color: <color>, thickness: <norm length>}\r\n     * \r\n     */\n    if (attr === \"none\") return attr;\n    var rslt = {};\n\n    if (attr.color === null) {\n      rslt.color = element.styleAttrs[imscStyles.byName.color.qname];\n    } else {\n      rslt.color = attr.color;\n    }\n\n    rslt.thickness = imscUtils.toComputedLength(attr.thickness.value, attr.thickness.unit, element.styleAttrs[imscStyles.byName.fontSize.qname], element.styleAttrs[imscStyles.byName.fontSize.qname], doc.cellLength.h, doc.pxLength.h);\n    if (rslt.thickness === null) return null;\n    return rslt;\n  }), new StylingAttributeDefinition(imscNames.ns_tts, \"textShadow\", \"none\", ['span'], true, true, imscUtils.parseTextShadow, function (doc, parent, element, attr) {\n    /*\r\n     * returns [{x_off: <length>, y_off: <length>, b_radius: <length>, color: <color>}*] or \"none\"\r\n     * \r\n     */\n    if (attr === \"none\") return attr;\n    var r = [];\n\n    for (var i in attr) {\n      var shadow = {};\n      shadow.x_off = imscUtils.toComputedLength(attr[i][0].value, attr[i][0].unit, null, element.styleAttrs[imscStyles.byName.fontSize.qname], null, doc.pxLength.w);\n      if (shadow.x_off === null) return null;\n      shadow.y_off = imscUtils.toComputedLength(attr[i][1].value, attr[i][1].unit, null, element.styleAttrs[imscStyles.byName.fontSize.qname], null, doc.pxLength.h);\n      if (shadow.y_off === null) return null;\n\n      if (attr[i][2] === null) {\n        shadow.b_radius = 0;\n      } else {\n        shadow.b_radius = imscUtils.toComputedLength(attr[i][2].value, attr[i][2].unit, null, element.styleAttrs[imscStyles.byName.fontSize.qname], null, doc.pxLength.h);\n        if (shadow.b_radius === null) return null;\n      }\n\n      if (attr[i][3] === null) {\n        shadow.color = element.styleAttrs[imscStyles.byName.color.qname];\n      } else {\n        shadow.color = attr[i][3];\n      }\n\n      r.push(shadow);\n    }\n\n    return r;\n  }), new StylingAttributeDefinition(imscNames.ns_tts, \"unicodeBidi\", \"normal\", ['span', 'p'], false, true, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"visibility\", \"visible\", ['body', 'div', 'p', 'region', 'span'], true, true, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"wrapOption\", \"wrap\", ['span'], true, true, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"writingMode\", \"lrtb\", ['region'], false, true, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_tts, \"zIndex\", \"auto\", ['region'], false, true, function (str) {\n    var rslt;\n\n    if (str === 'auto') {\n      rslt = str;\n    } else {\n      rslt = parseInt(str);\n\n      if (isNaN(rslt)) {\n        rslt = null;\n      }\n    }\n\n    return rslt;\n  }, null), new StylingAttributeDefinition(imscNames.ns_ebutts, \"linePadding\", \"0c\", ['p'], true, false, imscUtils.parseLength, function (doc, parent, element, attr, context) {\n    return imscUtils.toComputedLength(attr.value, attr.unit, null, null, doc.cellLength.w, null);\n  }), new StylingAttributeDefinition(imscNames.ns_ebutts, \"multiRowAlign\", \"auto\", ['p'], true, false, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_smpte, \"backgroundImage\", null, ['div'], false, false, function (str) {\n    return str;\n  }, null), new StylingAttributeDefinition(imscNames.ns_itts, \"forcedDisplay\", \"false\", ['body', 'div', 'p', 'region', 'span'], true, true, function (str) {\n    return str === 'true' ? true : false;\n  }, null), new StylingAttributeDefinition(imscNames.ns_itts, \"fillLineGap\", \"false\", ['p'], true, true, function (str) {\n    return str === 'true' ? true : false;\n  }, null)];\n  /* TODO: allow null parse function */\n\n  imscStyles.byQName = {};\n\n  for (var i in imscStyles.all) {\n    imscStyles.byQName[imscStyles.all[i].qname] = imscStyles.all[i];\n  }\n\n  imscStyles.byName = {};\n\n  for (var j in imscStyles.all) {\n    imscStyles.byName[imscStyles.all[j].name] = imscStyles.all[j];\n  }\n})(typeof exports === 'undefined' ? this.imscStyles = {} : exports, typeof imscNames === 'undefined' ? require(\"./names\") : imscNames, typeof imscUtils === 'undefined' ? require(\"./utils\") : imscUtils);","map":{"version":3,"sources":["/Users/webwerks1/Documents/Project/React Js Training/streamvideo/node_modules/imsc/src/main/js/styles.js"],"names":["imscStyles","imscNames","imscUtils","StylingAttributeDefinition","ns","name","initialValue","appliesTo","isInherit","isAnimatable","parseFunc","computeFunc","qname","inherit","animatable","initial","applies","parse","compute","all","ns_tts","parseColor","str","s","split","length","w","parseLength","h","doc","parent","element","attr","context","ComputedLength","toComputedLength","value","unit","dimensions","pxLength","ffs","rslt","i","charAt","push","fs","Math","abs","sign","styleAttrs","byName","fontSize","cellLength","lh","parseFloat","r","l","padding","dir","writingMode","out","extent","parsePosition","v","offset","rw","rh","edge","e","style","symbol","color","position","c","shift","thickness","parseTextShadow","shadow","x_off","y_off","b_radius","parseInt","isNaN","ns_ebutts","ns_smpte","ns_itts","byQName","j","exports","require"],"mappings":"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","sourcesContent":["/* \r\n * Copyright (c) 2016, Pierre-Anthony Lemieux <pal@sandflow.com>\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *\r\n * * Redistributions of source code must retain the above copyright notice, this\r\n *   list of conditions and the following disclaimer.\r\n * * Redistributions in binary form must reproduce the above copyright notice,\r\n *   this list of conditions and the following disclaimer in the documentation\r\n *   and/or other materials provided with the distribution.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\r\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\r\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\r\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\r\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\r\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\r\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\r\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n * POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n/**\r\n * @module imscStyles\r\n */\r\n\r\n;\r\n(function (imscStyles, imscNames, imscUtils) { // wrapper for non-node envs\r\n\r\n    function StylingAttributeDefinition(ns, name, initialValue, appliesTo, isInherit, isAnimatable, parseFunc, computeFunc) {\r\n        this.name = name;\r\n        this.ns = ns;\r\n        this.qname = ns + \" \" + name;\r\n        this.inherit = isInherit;\r\n        this.animatable = isAnimatable;\r\n        this.initial = initialValue;\r\n        this.applies = appliesTo;\r\n        this.parse = parseFunc;\r\n        this.compute = computeFunc;\r\n    }\r\n\r\n    imscStyles.all = [\r\n\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"backgroundColor\",\r\n            \"transparent\",\r\n            ['body', 'div', 'p', 'region', 'span'],\r\n            false,\r\n            true,\r\n            imscUtils.parseColor,\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"color\",\r\n            \"white\",\r\n            ['span'],\r\n            true,\r\n            true,\r\n            imscUtils.parseColor,\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"direction\",\r\n            \"ltr\",\r\n            ['p', 'span'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"display\",\r\n            \"auto\",\r\n            ['body', 'div', 'p', 'region', 'span'],\r\n            false,\r\n            true,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"displayAlign\",\r\n            \"before\",\r\n            ['region'],\r\n            false,\r\n            true,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"extent\",\r\n            \"auto\",\r\n            ['tt', 'region'],\r\n            false,\r\n            true,\r\n            function (str) {\r\n\r\n                if (str === \"auto\") {\r\n\r\n                    return str;\r\n\r\n                } else {\r\n\r\n                    var s = str.split(\" \");\r\n                    if (s.length !== 2)\r\n                        return null;\r\n                    var w = imscUtils.parseLength(s[0]);\r\n                    var h = imscUtils.parseLength(s[1]);\r\n                    if (!h || !w)\r\n                        return null;\r\n                    return {'h': h, 'w': w};\r\n                }\r\n\r\n            },\r\n            function (doc, parent, element, attr, context) {\r\n\r\n                var h;\r\n                var w;\r\n\r\n                if (attr === \"auto\") {\r\n\r\n                    h = new imscUtils.ComputedLength(0, 1);\r\n\r\n                } else {\r\n\r\n                    h = imscUtils.toComputedLength(\r\n                        attr.h.value,\r\n                        attr.h.unit,\r\n                        null,\r\n                        doc.dimensions.h,\r\n                        null,\r\n                        doc.pxLength.h\r\n                        );\r\n\r\n\r\n                    if (h === null) {\r\n\r\n                        return null;\r\n\r\n                    }\r\n                }\r\n\r\n                if (attr === \"auto\") {\r\n\r\n                    w = new imscUtils.ComputedLength(1, 0);\r\n\r\n                } else {\r\n\r\n                    w = imscUtils.toComputedLength(\r\n                        attr.w.value,\r\n                        attr.w.unit,\r\n                        null,\r\n                        doc.dimensions.w,\r\n                        null,\r\n                        doc.pxLength.w\r\n                        );\r\n\r\n                    if (w === null) {\r\n\r\n                        return null;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                return {'h': h, 'w': w};\r\n            }\r\n        ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"fontFamily\",\r\n            \"default\",\r\n            ['span', 'p'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                var ffs = str.split(\",\");\r\n                var rslt = [];\r\n\r\n                for (var i in ffs) {\r\n\r\n                    if (ffs[i].charAt(0) !== \"'\" && ffs[i].charAt(0) !== '\"') {\r\n\r\n                        if (ffs[i] === \"default\") {\r\n\r\n                            /* per IMSC1 */\r\n\r\n                            rslt.push(\"monospaceSerif\");\r\n\r\n                        } else {\r\n\r\n                            rslt.push(ffs[i]);\r\n\r\n                        }\r\n\r\n                    } else {\r\n\r\n                        rslt.push(ffs[i]);\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                return rslt;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"shear\",\r\n            \"0%\",\r\n            ['p'],\r\n            true,\r\n            true,\r\n            imscUtils.parseLength,\r\n            function (doc, parent, element, attr) {\r\n\r\n                var fs;\r\n\r\n                if (attr.unit === \"%\") {\r\n\r\n                    fs = Math.abs(attr.value) > 100 ? Math.sign(attr.value) * 100 : attr.value;\r\n\r\n                } else {\r\n\r\n                    return null;\r\n\r\n                }\r\n\r\n                return fs;\r\n            }\r\n        ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"fontSize\",\r\n            \"1c\",\r\n            ['span', 'p'],\r\n            true,\r\n            true,\r\n            imscUtils.parseLength,\r\n            function (doc, parent, element, attr, context) {\r\n\r\n                var fs;\r\n\r\n                fs = imscUtils.toComputedLength(\r\n                    attr.value,\r\n                    attr.unit,\r\n                    parent !== null ? parent.styleAttrs[imscStyles.byName.fontSize.qname] : doc.cellLength.h,\r\n                    parent !== null ? parent.styleAttrs[imscStyles.byName.fontSize.qname] : doc.cellLength.h,\r\n                    doc.cellLength.h,\r\n                    doc.pxLength.h\r\n                    );\r\n\r\n                return fs;\r\n            }\r\n        ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"fontStyle\",\r\n            \"normal\",\r\n            ['span', 'p'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                /* TODO: handle font style */\r\n\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"fontWeight\",\r\n            \"normal\",\r\n            ['span', 'p'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                /* TODO: handle font weight */\r\n\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"lineHeight\",\r\n            \"normal\",\r\n            ['p'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                if (str === \"normal\") {\r\n                    return str;\r\n                } else {\r\n                    return imscUtils.parseLength(str);\r\n                }\r\n            },\r\n            function (doc, parent, element, attr, context) {\r\n\r\n                var lh;\r\n\r\n                if (attr === \"normal\") {\r\n\r\n                    /* inherit normal per https://github.com/w3c/ttml1/issues/220 */\r\n\r\n                    lh = attr;\r\n\r\n                } else {\r\n\r\n                    lh = imscUtils.toComputedLength(\r\n                        attr.value,\r\n                        attr.unit,\r\n                        element.styleAttrs[imscStyles.byName.fontSize.qname],\r\n                        element.styleAttrs[imscStyles.byName.fontSize.qname],\r\n                        doc.cellLength.h,\r\n                        doc.pxLength.h\r\n                        );\r\n\r\n                    if (lh === null) {\r\n\r\n                        return null;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                /* TODO: create a Length constructor */\r\n\r\n                return lh;\r\n            }\r\n        ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"opacity\",\r\n            1.0,\r\n            ['region'],\r\n            false,\r\n            true,\r\n            parseFloat,\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"origin\",\r\n            \"auto\",\r\n            ['region'],\r\n            false,\r\n            true,\r\n            function (str) {\r\n\r\n                if (str === \"auto\") {\r\n\r\n                    return str;\r\n\r\n                } else {\r\n\r\n                    var s = str.split(\" \");\r\n                    if (s.length !== 2)\r\n                        return null;\r\n                    var w = imscUtils.parseLength(s[0]);\r\n                    var h = imscUtils.parseLength(s[1]);\r\n                    if (!h || !w)\r\n                        return null;\r\n                    return {'h': h, 'w': w};\r\n                }\r\n\r\n            },\r\n            function (doc, parent, element, attr, context) {\r\n\r\n                var h;\r\n                var w;\r\n\r\n                if (attr === \"auto\") {\r\n\r\n                    h = new imscUtils.ComputedLength(0,0);\r\n\r\n                } else {\r\n\r\n                    h = imscUtils.toComputedLength(\r\n                        attr.h.value,\r\n                        attr.h.unit,\r\n                        null,\r\n                        doc.dimensions.h,\r\n                        null,\r\n                        doc.pxLength.h\r\n                        );\r\n\r\n                    if (h === null) {\r\n\r\n                        return null;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                if (attr === \"auto\") {\r\n\r\n                    w = new imscUtils.ComputedLength(0,0);\r\n\r\n                } else {\r\n\r\n                    w = imscUtils.toComputedLength(\r\n                        attr.w.value,\r\n                        attr.w.unit,\r\n                        null,\r\n                        doc.dimensions.w,\r\n                        null,\r\n                        doc.pxLength.w\r\n                        );\r\n\r\n                    if (w === null) {\r\n\r\n                        return null;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                return {'h': h, 'w': w};\r\n            }\r\n        ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"overflow\",\r\n            \"hidden\",\r\n            ['region'],\r\n            false,\r\n            true,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"padding\",\r\n            \"0px\",\r\n            ['region'],\r\n            false,\r\n            true,\r\n            function (str) {\r\n\r\n                var s = str.split(\" \");\r\n                if (s.length > 4)\r\n                    return null;\r\n                var r = [];\r\n                for (var i in s) {\r\n\r\n                    var l = imscUtils.parseLength(s[i]);\r\n                    if (!l)\r\n                        return null;\r\n                    r.push(l);\r\n                }\r\n\r\n                return r;\r\n            },\r\n            function (doc, parent, element, attr, context) {\r\n\r\n                var padding;\r\n\r\n                /* TODO: make sure we are in region */\r\n\r\n                /*\r\n                 * expand padding shortcuts to \r\n                 * [before, end, after, start]\r\n                 * \r\n                 */\r\n\r\n                if (attr.length === 1) {\r\n\r\n                    padding = [attr[0], attr[0], attr[0], attr[0]];\r\n\r\n                } else if (attr.length === 2) {\r\n\r\n                    padding = [attr[0], attr[1], attr[0], attr[1]];\r\n\r\n                } else if (attr.length === 3) {\r\n\r\n                    padding = [attr[0], attr[1], attr[2], attr[1]];\r\n\r\n                } else if (attr.length === 4) {\r\n\r\n                    padding = [attr[0], attr[1], attr[2], attr[3]];\r\n\r\n                } else {\r\n\r\n                    return null;\r\n\r\n                }\r\n\r\n                /* TODO: take into account tts:direction */\r\n\r\n                /* \r\n                 * transform [before, end, after, start] according to writingMode to \r\n                 * [top,left,bottom,right]\r\n                 * \r\n                 */\r\n\r\n                var dir = element.styleAttrs[imscStyles.byName.writingMode.qname];\r\n\r\n                if (dir === \"lrtb\" || dir === \"lr\") {\r\n\r\n                    padding = [padding[0], padding[3], padding[2], padding[1]];\r\n\r\n                } else if (dir === \"rltb\" || dir === \"rl\") {\r\n\r\n                    padding = [padding[0], padding[1], padding[2], padding[3]];\r\n\r\n                } else if (dir === \"tblr\") {\r\n\r\n                    padding = [padding[3], padding[0], padding[1], padding[2]];\r\n\r\n                } else if (dir === \"tbrl\" || dir === \"tb\") {\r\n\r\n                    padding = [padding[3], padding[2], padding[1], padding[0]];\r\n\r\n                } else {\r\n\r\n                    return null;\r\n\r\n                }\r\n\r\n                var out = [];\r\n\r\n                for (var i in padding) {\r\n\r\n                    if (padding[i].value === 0) {\r\n\r\n                        out[i] = new imscUtils.ComputedLength(0,0);\r\n\r\n                    } else {\r\n\r\n                        out[i] = imscUtils.toComputedLength(\r\n                            padding[i].value,\r\n                            padding[i].unit,\r\n                            element.styleAttrs[imscStyles.byName.fontSize.qname],\r\n                            i === \"0\" || i === \"2\" ? element.styleAttrs[imscStyles.byName.extent.qname].h : element.styleAttrs[imscStyles.byName.extent.qname].w,\r\n                            i === \"0\" || i === \"2\" ? doc.cellLength.h : doc.cellLength.w,\r\n                            i === \"0\" || i === \"2\" ? doc.pxLength.h: doc.pxLength.w\r\n                            );\r\n\r\n                        if (out[i] === null) return null;\r\n\r\n                    }\r\n                }\r\n\r\n\r\n                return out;\r\n            }\r\n        ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"position\",\r\n            \"top left\",\r\n            ['region'],\r\n            false,\r\n            true,\r\n            function (str) {\r\n\r\n                return imscUtils.parsePosition(str);\r\n\r\n            },\r\n            function (doc, parent, element, attr) {\r\n                var h;\r\n                var w;\r\n                \r\n                h = imscUtils.toComputedLength(\r\n                    attr.v.offset.value,\r\n                    attr.v.offset.unit,\r\n                    null,\r\n                    new imscUtils.ComputedLength(\r\n                        - element.styleAttrs[imscStyles.byName.extent.qname].h.rw,\r\n                        doc.dimensions.h.rh - element.styleAttrs[imscStyles.byName.extent.qname].h.rh \r\n                    ),\r\n                    null,\r\n                    doc.pxLength.h\r\n                    );\r\n\r\n                if (h === null) return null;\r\n\r\n\r\n                if (attr.v.edge === \"bottom\") {\r\n\r\n                    h = new imscUtils.ComputedLength(\r\n                        - h.rw - element.styleAttrs[imscStyles.byName.extent.qname].h.rw,\r\n                        doc.dimensions.h.rh - h.rh - element.styleAttrs[imscStyles.byName.extent.qname].h.rh\r\n                    );\r\n            \r\n                }\r\n\r\n                w = imscUtils.toComputedLength(\r\n                    attr.h.offset.value,\r\n                    attr.h.offset.unit,\r\n                    null,\r\n                    new imscUtils.ComputedLength(\r\n                        doc.dimensions.w.rw - element.styleAttrs[imscStyles.byName.extent.qname].w.rw,\r\n                        - element.styleAttrs[imscStyles.byName.extent.qname].w.rh\r\n                    ),\r\n                    null,\r\n                    doc.pxLength.w\r\n                    );\r\n\r\n                if (h === null) return null;\r\n\r\n                if (attr.h.edge === \"right\") {\r\n                    \r\n                    w = new imscUtils.ComputedLength(\r\n                        doc.dimensions.w.rw - w.rw - element.styleAttrs[imscStyles.byName.extent.qname].w.rw,\r\n                        - w.rh - element.styleAttrs[imscStyles.byName.extent.qname].w.rh\r\n                    );\r\n\r\n                }\r\n\r\n                return {'h': h, 'w': w};\r\n            }\r\n        ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"ruby\",\r\n            \"none\",\r\n            ['span'],\r\n            false,\r\n            true,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"rubyAlign\",\r\n            \"center\",\r\n            ['span'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                \r\n                if (! (str === \"center\" || str === \"spaceAround\")) {\r\n                    return null;\r\n                }\r\n                \r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"rubyPosition\",\r\n            \"outside\",\r\n            ['span'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"rubyReserve\",\r\n            \"none\",\r\n            ['p'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                var s = str.split(\" \");\r\n\r\n                var r = [null, null];\r\n\r\n                if (s.length === 0 || s.length > 2)\r\n                    return null;\r\n\r\n                if (s[0] === \"none\" ||\r\n                    s[0] === \"both\" ||\r\n                    s[0] === \"after\" ||\r\n                    s[0] === \"before\" ||\r\n                    s[0] === \"outside\") {\r\n\r\n                    r[0] = s[0];\r\n\r\n                } else {\r\n\r\n                    return null;\r\n\r\n                }\r\n\r\n                if (s.length === 2 && s[0] !== \"none\") {\r\n\r\n                    var l = imscUtils.parseLength(s[1]);\r\n\r\n                    if (l) {\r\n\r\n                        r[1] = l;\r\n\r\n                    } else {\r\n\r\n                        return null;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n\r\n                return r;\r\n            },\r\n            function (doc, parent, element, attr, context) {\r\n\r\n                if (attr[0] === \"none\") {\r\n\r\n                    return attr;\r\n\r\n                }\r\n\r\n                var fs = null;\r\n\r\n                if (attr[1] === null) {\r\n\r\n                    fs = new imscUtils.ComputedLength(\r\n                            element.styleAttrs[imscStyles.byName.fontSize.qname].rw * 0.5,\r\n                            element.styleAttrs[imscStyles.byName.fontSize.qname].rh * 0.5\r\n                    );\r\n\r\n                } else {\r\n\r\n                    fs = imscUtils.toComputedLength(attr[1].value,\r\n                        attr[1].unit,\r\n                        element.styleAttrs[imscStyles.byName.fontSize.qname],\r\n                        element.styleAttrs[imscStyles.byName.fontSize.qname],\r\n                        doc.cellLength.h,\r\n                        doc.pxLength.h\r\n                        );\r\n                \r\n                }\r\n\r\n                if (fs === null) return null;\r\n\r\n                return [attr[0], fs];\r\n            }\r\n        ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"showBackground\",\r\n            \"always\",\r\n            ['region'],\r\n            false,\r\n            true,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"textAlign\",\r\n            \"start\",\r\n            ['p'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            function (doc, parent, element, attr, context) {\r\n                /* Section 7.16.9 of XSL */\r\n\r\n                if (attr === \"left\") {\r\n\r\n                    return \"start\";\r\n\r\n                } else if (attr === \"right\") {\r\n\r\n                    return \"end\";\r\n\r\n                } else {\r\n\r\n                    return attr;\r\n\r\n                }\r\n            }\r\n        ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"textCombine\",\r\n            \"none\",\r\n            ['span'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                if (str === \"none\" || str === \"all\") {\r\n\r\n                    return str;\r\n                }\r\n\r\n                return null;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"textDecoration\",\r\n            \"none\",\r\n            ['span'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                return str.split(\" \");\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"textEmphasis\",\r\n            \"none\",\r\n            ['span'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                var e = str.split(\" \");\r\n\r\n                var rslt = {style: null, symbol: null, color: null, position: null};\r\n\r\n                for (var i in e) {\r\n\r\n                    if (e[i] === \"none\" || e[i] === \"auto\") {\r\n\r\n                        rslt.style = e[i];\r\n\r\n                    } else if (e[i] === \"filled\" ||\r\n                        e[i] === \"open\") {\r\n\r\n                        rslt.style = e[i];\r\n\r\n                    } else if (e[i] === \"circle\" ||\r\n                        e[i] === \"dot\" ||\r\n                        e[i] === \"sesame\") {\r\n\r\n                        rslt.symbol = e[i];\r\n\r\n                    } else if (e[i] === \"current\") {\r\n\r\n                        rslt.color = e[i];\r\n\r\n                    } else if (e[i] === \"outside\" || e[i] === \"before\" || e[i] === \"after\") {\r\n\r\n                        rslt.position = e[i];\r\n\r\n                    } else {\r\n\r\n                        rslt.color = imscUtils.parseColor(e[i]);\r\n\r\n                        if (rslt.color === null)\r\n                            return null;\r\n\r\n                    }\r\n                }\r\n\r\n                if (rslt.style == null && rslt.symbol == null) {\r\n\r\n                    rslt.style = \"auto\";\r\n\r\n                } else {\r\n\r\n                    rslt.symbol = rslt.symbol || \"circle\";\r\n                    rslt.style = rslt.style || \"filled\";\r\n\r\n                }\r\n\r\n                rslt.position = rslt.position || \"outside\";\r\n                rslt.color = rslt.color || \"current\";\r\n\r\n                return rslt;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"textOutline\",\r\n            \"none\",\r\n            ['span'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n\r\n                /*\r\n                 * returns {c: <color>?, thichness: <length>} | \"none\"\r\n                 * \r\n                 */\r\n\r\n                if (str === \"none\") {\r\n\r\n                    return str;\r\n\r\n                } else {\r\n\r\n                    var r = {};\r\n                    var s = str.split(\" \");\r\n                    if (s.length === 0 || s.length > 2)\r\n                        return null;\r\n                    var c = imscUtils.parseColor(s[0]);\r\n\r\n                    r.color = c;\r\n\r\n                    if (c !== null)\r\n                        s.shift();\r\n\r\n                    if (s.length !== 1)\r\n                        return null;\r\n\r\n                    var l = imscUtils.parseLength(s[0]);\r\n\r\n                    if (!l)\r\n                        return null;\r\n\r\n                    r.thickness = l;\r\n\r\n                    return r;\r\n                }\r\n\r\n            },\r\n            function (doc, parent, element, attr, context) {\r\n\r\n                /*\r\n                 * returns {color: <color>, thickness: <norm length>}\r\n                 * \r\n                 */\r\n\r\n                if (attr === \"none\")\r\n                    return attr;\r\n\r\n                var rslt = {};\r\n\r\n                if (attr.color === null) {\r\n\r\n                    rslt.color = element.styleAttrs[imscStyles.byName.color.qname];\r\n\r\n                } else {\r\n\r\n                    rslt.color = attr.color;\r\n\r\n                }\r\n\r\n                rslt.thickness = imscUtils.toComputedLength(\r\n                    attr.thickness.value,\r\n                    attr.thickness.unit,\r\n                    element.styleAttrs[imscStyles.byName.fontSize.qname],\r\n                    element.styleAttrs[imscStyles.byName.fontSize.qname],\r\n                    doc.cellLength.h,\r\n                    doc.pxLength.h\r\n                    );\r\n\r\n                if (rslt.thickness === null)\r\n                    return null;\r\n\r\n                return rslt;\r\n            }\r\n        ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"textShadow\",\r\n            \"none\",\r\n            ['span'],\r\n            true,\r\n            true,\r\n            imscUtils.parseTextShadow,\r\n            function (doc, parent, element, attr) {\r\n\r\n                /*\r\n                 * returns [{x_off: <length>, y_off: <length>, b_radius: <length>, color: <color>}*] or \"none\"\r\n                 * \r\n                 */\r\n\r\n                if (attr === \"none\")\r\n                    return attr;\r\n\r\n                var r = [];\r\n\r\n                for (var i in attr) {\r\n\r\n                    var shadow = {};\r\n\r\n                    shadow.x_off = imscUtils.toComputedLength(\r\n                        attr[i][0].value,\r\n                        attr[i][0].unit,\r\n                        null,\r\n                        element.styleAttrs[imscStyles.byName.fontSize.qname],\r\n                        null,\r\n                        doc.pxLength.w\r\n                        );\r\n\r\n                    if (shadow.x_off === null)\r\n                        return null;\r\n\r\n                    shadow.y_off = imscUtils.toComputedLength(\r\n                        attr[i][1].value,\r\n                        attr[i][1].unit,\r\n                        null,\r\n                        element.styleAttrs[imscStyles.byName.fontSize.qname],\r\n                        null,\r\n                        doc.pxLength.h\r\n                        );\r\n\r\n                    if (shadow.y_off === null)\r\n                        return null;\r\n\r\n                    if (attr[i][2] === null) {\r\n\r\n                        shadow.b_radius = 0;\r\n\r\n                    } else {\r\n\r\n                        shadow.b_radius = imscUtils.toComputedLength(\r\n                            attr[i][2].value,\r\n                            attr[i][2].unit,\r\n                            null,\r\n                            element.styleAttrs[imscStyles.byName.fontSize.qname],\r\n                            null,\r\n                            doc.pxLength.h\r\n                            );\r\n\r\n                        if (shadow.b_radius === null)\r\n                            return null;\r\n\r\n                    }\r\n\r\n                    if (attr[i][3] === null) {\r\n\r\n                        shadow.color = element.styleAttrs[imscStyles.byName.color.qname];\r\n\r\n                    } else {\r\n\r\n                        shadow.color = attr[i][3];\r\n\r\n                    }\r\n\r\n                    r.push(shadow);\r\n\r\n                }\r\n\r\n                return r;\r\n            }\r\n        ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"unicodeBidi\",\r\n            \"normal\",\r\n            ['span', 'p'],\r\n            false,\r\n            true,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"visibility\",\r\n            \"visible\",\r\n            ['body', 'div', 'p', 'region', 'span'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"wrapOption\",\r\n            \"wrap\",\r\n            ['span'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"writingMode\",\r\n            \"lrtb\",\r\n            ['region'],\r\n            false,\r\n            true,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_tts,\r\n            \"zIndex\",\r\n            \"auto\",\r\n            ['region'],\r\n            false,\r\n            true,\r\n            function (str) {\r\n\r\n                var rslt;\r\n\r\n                if (str === 'auto') {\r\n\r\n                    rslt = str;\r\n\r\n                } else {\r\n\r\n                    rslt = parseInt(str);\r\n\r\n                    if (isNaN(rslt)) {\r\n                        rslt = null;\r\n                    }\r\n\r\n                }\r\n\r\n                return rslt;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_ebutts,\r\n            \"linePadding\",\r\n            \"0c\",\r\n            ['p'],\r\n            true,\r\n            false,\r\n            imscUtils.parseLength,\r\n            function (doc, parent, element, attr, context) {\r\n\r\n                return imscUtils.toComputedLength(attr.value, attr.unit, null, null, doc.cellLength.w, null);\r\n\r\n            }\r\n        ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_ebutts,\r\n            \"multiRowAlign\",\r\n            \"auto\",\r\n            ['p'],\r\n            true,\r\n            false,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_smpte,\r\n            \"backgroundImage\",\r\n            null,\r\n            ['div'],\r\n            false,\r\n            false,\r\n            function (str) {\r\n                return str;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_itts,\r\n            \"forcedDisplay\",\r\n            \"false\",\r\n            ['body', 'div', 'p', 'region', 'span'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                return str === 'true' ? true : false;\r\n            },\r\n            null\r\n            ),\r\n        new StylingAttributeDefinition(\r\n            imscNames.ns_itts,\r\n            \"fillLineGap\",\r\n            \"false\",\r\n            ['p'],\r\n            true,\r\n            true,\r\n            function (str) {\r\n                return str === 'true' ? true : false;\r\n            },\r\n            null\r\n            )\r\n    ];\r\n\r\n    /* TODO: allow null parse function */\r\n\r\n    imscStyles.byQName = {};\r\n    for (var i in imscStyles.all) {\r\n\r\n        imscStyles.byQName[imscStyles.all[i].qname] = imscStyles.all[i];\r\n    }\r\n\r\n    imscStyles.byName = {};\r\n    for (var j in imscStyles.all) {\r\n\r\n        imscStyles.byName[imscStyles.all[j].name] = imscStyles.all[j];\r\n    }\r\n\r\n\r\n})(typeof exports === 'undefined' ? this.imscStyles = {} : exports,\r\n    typeof imscNames === 'undefined' ? require(\"./names\") : imscNames,\r\n    typeof imscUtils === 'undefined' ? require(\"./utils\") : imscUtils);\r\n"]},"metadata":{},"sourceType":"script"}